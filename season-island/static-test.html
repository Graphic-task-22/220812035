<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é™æ€è§’è‰²æµ‹è¯•</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            background: #000;
            font-family: Arial, sans-serif;
            overflow: hidden;
        }
        
        #gameContainer {
            width: 100vw;
            height: 100vh;
            position: relative;
        }
        
        .ui-panel {
            position: absolute;
            top: 20px;
            left: 20px;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 20px;
            border-radius: 10px;
            z-index: 1000;
            min-width: 300px;
        }
        
        .ui-panel h2 {
            margin: 0 0 15px 0;
            color: #4CAF50;
        }
        
        .control-group {
            margin-bottom: 15px;
        }
        
        .control-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        
        .control-group select {
            width: 100%;
            padding: 8px;
            border: none;
            border-radius: 5px;
            background: #333;
            color: white;
        }
        
        .info-panel {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 15px;
            border-radius: 10px;
            z-index: 1000;
            font-size: 14px;
        }
        
        .info-item {
            margin-bottom: 8px;
        }
        
        .status {
            padding: 5px 10px;
            border-radius: 3px;
            font-size: 12px;
            margin-left: 10px;
        }
        
        .status.success {
            background: #4CAF50;
        }
        
        .status.error {
            background: #f44336;
        }
        
        .status.warning {
            background: #ff9800;
        }
        
        .instructions {
            position: absolute;
            bottom: 20px;
            left: 20px;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 15px;
            border-radius: 10px;
            z-index: 1000;
            max-width: 400px;
        }
        
        .instructions h3 {
            margin: 0 0 10px 0;
            color: #4CAF50;
        }
        
        .instructions ul {
            margin: 0;
            padding-left: 20px;
        }
        
        .instructions li {
            margin-bottom: 5px;
        }
    </style>
</head>
<body>
    <div id="gameContainer">
        <div class="ui-panel">
            <h2>ğŸŒ´ å››å­£æµ·å²› - é™æ€è§’è‰²æµ‹è¯•</h2>
            
            <div class="control-group">
                <label for="seasonSelect">å­£èŠ‚:</label>
                <select id="seasonSelect">
                    <option value="spring">æ˜¥å­£</option>
                    <option value="summer">å¤å­£</option>
                    <option value="autumn">ç§‹å­£</option>
                    <option value="winter">å†¬å­£</option>
                </select>
            </div>
            
            <div class="control-group">
                <label for="timeSelect">æ—¶é—´:</label>
                <select id="timeSelect">
                    <option value="morning">æ—©æ™¨</option>
                    <option value="noon">ä¸­åˆ</option>
                    <option value="evening">å‚æ™š</option>
                    <option value="night">å¤œæ™š</option>
                </select>
            </div>
            
            <div class="control-group">
                <label for="weatherSelect">å¤©æ°”:</label>
                <select id="weatherSelect">
                    <option value="sunny">æ™´å¤©</option>
                    <option value="cloudy">å¤šäº‘</option>
                    <option value="rainy">é›¨å¤©</option>
                    <option value="snowy">é›ªå¤©</option>
                </select>
            </div>
        </div>
        
        <div class="info-panel">
            <h3>ğŸ“Š çŠ¶æ€ä¿¡æ¯</h3>
            <div class="info-item">
                è§’è‰²ä½ç½®: <span id="playerPos">åŠ è½½ä¸­...</span>
            </div>
            <div class="info-item">
                åœ°é¢æ£€æµ‹: <span id="groundStatus" class="status warning">æ£€æµ‹ä¸­...</span>
            </div>
            <div class="info-item">
                ç§»åŠ¨çŠ¶æ€: <span id="moveStatus" class="status">é™æ­¢</span>
            </div>
            <div class="info-item">
                FPS: <span id="fps">--</span>
            </div>
        </div>
        
        <div class="instructions">
            <h3>ğŸ® æ“ä½œè¯´æ˜</h3>
            <ul>
                <li><strong>WASD</strong> - ç§»åŠ¨è§’è‰²</li>
                <li><strong>ç©ºæ ¼</strong> - è·³è·ƒ</li>
                <li><strong>Shift</strong> - åŠ é€Ÿç§»åŠ¨</li>
                <li><strong>é¼ æ ‡</strong> - è§†è§’æ§åˆ¶</li>
                <li><strong>F1</strong> - åœºæ™¯ä¿¡æ¯</li>
                <li><strong>F2</strong> - è§’è‰²ä¿¡æ¯</li>
                <li><strong>F3</strong> - æ€§èƒ½æŠ¥å‘Š</li>
            </ul>
        </div>
    </div>

    <script type="module">
        import { GameScene } from './src/GameScene.js';
        
        // å…¨å±€å˜é‡
        let gameScene = null;
        let frameCount = 0;
        let lastTime = performance.now();
        
        // æ›´æ–°çŠ¶æ€ä¿¡æ¯
        function updateStatus() {
            if (!gameScene || !gameScene.player) return;
            
            // æ›´æ–°è§’è‰²ä½ç½®
            const pos = gameScene.player.position;
            document.getElementById('playerPos').textContent = 
                `X: ${pos.x.toFixed(2)}, Y: ${pos.y.toFixed(2)}, Z: ${pos.z.toFixed(2)}`;
            
            // æ›´æ–°åœ°é¢æ£€æµ‹çŠ¶æ€
            const groundStatus = document.getElementById('groundStatus');
            if (gameScene.playerOnGround) {
                groundStatus.textContent = 'åœ¨åœ°é¢';
                groundStatus.className = 'status success';
            } else {
                groundStatus.textContent = 'æ‚¬ç©º';
                groundStatus.className = 'status error';
            }
            
            // æ›´æ–°ç§»åŠ¨çŠ¶æ€
            const moveStatus = document.getElementById('moveStatus');
            if (gameScene.playerDirection && gameScene.playerDirection.length() > 0) {
                moveStatus.textContent = 'ç§»åŠ¨ä¸­';
                moveStatus.className = 'status success';
            } else {
                moveStatus.textContent = 'é™æ­¢';
                moveStatus.className = 'status';
            }
            
            // æ›´æ–°FPS
            frameCount++;
            const currentTime = performance.now();
            if (currentTime - lastTime >= 1000) {
                const fps = Math.round((frameCount * 1000) / (currentTime - lastTime));
                document.getElementById('fps').textContent = fps;
                frameCount = 0;
                lastTime = currentTime;
            }
        }
        
        // åˆå§‹åŒ–æ¸¸æˆ
        async function initGame() {
            try {
                console.log('å¼€å§‹åˆå§‹åŒ–é™æ€è§’è‰²æµ‹è¯•...');
                
                gameScene = new GameScene();
                await gameScene.init();
                gameScene.setupControls();
                gameScene.start();
                
                // å¯åŠ¨çŠ¶æ€æ›´æ–°
                setInterval(updateStatus, 100);
                
                console.log('é™æ€è§’è‰²æµ‹è¯•åˆå§‹åŒ–å®Œæˆ');
                
            } catch (error) {
                console.error('é™æ€è§’è‰²æµ‹è¯•åˆå§‹åŒ–å¤±è´¥:', error);
                document.body.innerHTML = `
                    <div style="color: white; padding: 50px; text-align: center;">
                        <h1>âŒ åˆå§‹åŒ–å¤±è´¥</h1>
                        <p>é”™è¯¯ä¿¡æ¯: ${error.message}</p>
                        <p>è¯·æ£€æŸ¥æ§åˆ¶å°è·å–è¯¦ç»†ä¿¡æ¯</p>
                    </div>
                `;
            }
        }
        
        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        window.addEventListener('load', initGame);
        
        // è°ƒè¯•å¿«æ·é”®
        document.addEventListener('keydown', (event) => {
            if (event.code === 'F1') {
                event.preventDefault();
                console.log('=== åœºæ™¯ä¿¡æ¯ ===');
                console.log('åœºæ™¯å¯¹è±¡æ•°é‡:', gameScene.scene.children.length);
                console.log('åœ°é¢å¯¹è±¡æ•°é‡:', gameScene.groundObjects.length);
                console.log('ç¢°æ’å¯¹è±¡æ•°é‡:', gameScene.collisionObjects.length);
            }
            if (event.code === 'F2') {
                event.preventDefault();
                console.log('=== è§’è‰²ä¿¡æ¯ ===');
                if (gameScene.player) {
                    console.log('è§’è‰²ä½ç½®:', gameScene.player.position);
                    console.log('è§’è‰²æ—‹è½¬:', gameScene.player.rotation);
                    console.log('è§’è‰²ç¼©æ”¾:', gameScene.player.scale);
                    console.log('åœ¨åœ°é¢:', gameScene.playerOnGround);
                }
            }
            if (event.code === 'F3') {
                event.preventDefault();
                console.log('=== æ€§èƒ½æŠ¥å‘Š ===');
                if (gameScene.performanceMonitor) {
                    console.log(gameScene.performanceMonitor.getPerformanceReport());
                }
            }
        });
    </script>
</body>
</html> 